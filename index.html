<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Whyld World MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- A-Frame & AR.js -->
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

  <style>
    /* Prevent horizontal overflow on mobile */
    html, body { width:100%; max-width:100vw; overflow-x:hidden; margin:0; }
    *, *::before, *::after { box-sizing: border-box; }

    body { overflow:auto; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }

    /* AR scene panel height so page can scroll to the map */
    .scene-wrap { width: 100%; height: 70vh; position: relative; }

    /* Fixed lens bar */
    .ui {
      position: fixed; left: 0; right: 0; bottom: 12px;
      display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;
      padding: 8px 12px; pointer-events: none; z-index: 10;
    }
    .btn {
      pointer-events: auto;
      background: rgba(255,255,255,0.9);
      border-radius: 999px; padding: 8px 14px; border: 1px solid #ddd;
      font-size: 14px; cursor: pointer;
    }

    /* Center the info card on mobile */
    .card {
      position: fixed; top: 14px; left: 0; right: 0; margin: 0 auto;
      max-width: 560px; width: calc(100% - 24px);
      background: rgba(255,255,255,0.98);
      border: 1px solid #ddd; border-radius: 14px; padding: 14px;
      display: none; box-shadow: 0 8px 18px rgba(0,0,0,0.15);
      z-index: 11;
    }
    .card h3 { margin: 0 0 6px 0; font-size: 18px; }
    .card p  { margin: 8px 0; font-size: 15px; line-height: 1.35; }
    .card .row { display:flex; gap:10px; margin-top: 10px; }
    .link { color: #0b65c2; text-decoration: underline; cursor:pointer; }
    .close { margin-left:auto; background:#f4f4f4; }

    /* Container for the ripple map section */
    .container { max-width: 1100px; margin: 0 auto 32px; padding: 0 12px; }

    /* Spacer so fixed buttons don’t overlap the map header */
    .spacer { height: 84px; }

    /* Make Airtable embed fully responsive on iOS */
    iframe.airtable-embed {
      display:block; width:1px; min-width:100%; max-width:100%;
      border: 1px solid #ccc; border-radius: 8px;
    }

    /* Keep A-Frame canvas within viewport width */
    a-scene, .a-canvas, canvas { max-width:100% !important; }

    @media (max-width: 480px){
      iframe.airtable-embed { height: 760px; }
    }
  </style>
</head>
<body>

  <!-- AR Scene wrapped so it doesn't occupy full page height -->
  <div class="scene-wrap">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" style="width:100%; height:100%;">
      <!-- Marker (use printed HIRO marker) -->
      <a-marker preset="hiro">

        <!-- CENTERED OVERLAY:
             - Keep position at 0 0 0 (center of marker)
             - Use rotation -90 0 0 so it's flat on the marker plane
             - Keep small scale so you can see the whole thing -->
        <a-entity position="0 0 0" rotation="-90 0 0" scale="0.8 0.8 0.8">
          <!-- a-plane acts as a centered label background -->
          <a-plane width="1.2" height="0.42" color="#ffffff" opacity="0.92" position="0 0 0.02"></a-plane>
          <!-- centered text -->
          <a-text value="Point at the marker to reveal layers →"
                  align="center" color="#222" width="1.8" position="0 0 0.03"></a-text>
          <!-- subtle ring cue, centered -->
          <a-torus radius="0.35" radius-tubular="0.02" color="#3a86ff" opacity="0.85" position="0 -0.4 0.02"></a-torus>
        </a-entity>

      </a-marker>
      <a-entity camera></a-entity>
    </a-scene>
  </div>

  <!-- Lens content card -->
  <div id="card" class="card">
    <h3 id="card-title">Explore</h3>
    <p id="card-text">
      Replace with your Explore story (50–80 words).
    </p>
    <div class="row">
      <a id="reflect-link" class="link" href="#" target="_blank">Leave a reflection</a>
      <button class="btn" onclick="scrollToMap()">View Ripple Map</button>
      <button class="btn close" onclick="hideCard()">Close</button>
    </div>
  </div>

  <!-- Bottom UI: lens buttons -->
  <div class="ui">
    <button class="btn" onclick="showLens('Explore')">Explore</button>
    <button class="btn" onclick="showLens('Serve')">Serve</button>
    <button class="btn" onclick="showLens('Create')">Create</button>
    <button class="btn" onclick="showLens('Inspire')">Inspire</button>
    <button class="btn" onclick="showLens('Reflect')">Reflect</button>
  </div>

  <script>
    // Paste your reflection form URL here:
    const FORM_URL_BASE = "https://YOUR_FORM_LINK_HERE"; // Typeform/Google/Airtable link

    const STORIES = {
      "Explore": "Replace with your Explore story (50–80 words).",
      "Serve":   "Replace with your Serve story (50–80 words).",
      "Create":  "Replace with your Create story (50–80 words).",
      "Inspire": "Replace with your Inspire story (50–80 words).",
      "Reflect": "Replace with your Reflect prompt or question."
    };

    function showLens(lens) {
      document.getElementById("card-title").innerText = lens;
      document.getElementById("card-text").innerText = STORIES[lens];
      const link = FORM_URL_BASE.includes("?") ? `${FORM_URL_BASE}&lens=${encodeURIComponent(lens)}` :
                                                 `${FORM_URL_BASE}?lens=${encodeURIComponent(lens)}`;
      document.getElementById("reflect-link").href = link;
      document.getElementById("card").style.display = "block";
    }
    function hideCard(){ document.getElementById("card").style.display = "none"; }

    function scrollToMap(){
      hideCard();
      requestAnimationFrame(() => {
        document.getElementById('ripple-map')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    }
  </script>

  <!-- Spacer so the fixed bottom buttons don’t overlap the map header -->
  <div class="spacer"></div>

  <!-- Ripple Map embed (use Airtable's 'Embed this view' + script) -->
  <div id="ripple-map" class="container">
    <h2 style="font-weight:600; font-size:20px; margin: 12px 0;">Ripple Map</h2>

    <iframe class="airtable-embed"
      src="https://airtable.com/embed/appXPj1T4lTXjx1kD/shrbHO75qu9JoaB37?viewControls=on"
      frameborder="0" height="800">
    </iframe>

    <script src="https://static.airtable.com/js/embed/embed_snippet_v1.js"></script>
  </div>
</body>
</html>
